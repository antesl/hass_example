Захотелось мне очень точно определять, когда конкретный пользователь входит в дом. 
Для теста придумал задачу, что как только пользователь входит в квартиру, Яндекс Станция приветствует его по имени. 

Довольно долго выбирал как определять, что пользователь дома. GPS, Wi-fi (MAC адрес в сети или пинг, или уровень сигнала), bluetooth. 
Остановился на варианте с пингом по Wi-fi

Минусы всех способов:
* GPS в подъезде не ловит, только около. В общем точность не та. 
* Wi-Fi начинает ловить в подъезде, когда пользователь еще не подошел к двери. Выбирая из отслеживать MAC адрес или уровень сигнала домашней сети или пинг, остановился в итоге на пингах. Как на наиболее универсальном способ
* По bluetooth получается довольно точно понять, что человек зашел, но радиус действия маленький и не во всех комнатах ловит. Получается что для HA нет разницы, с улицы пользователь пришел или из другой комнаты прошел мимо сервера.

В итоге понял, что надо два события, для точного определения. 
Датачик открытия вхожной двери точно показывается, когда кто-то вошел\вышел.
Пинг показывает, что определенный пользоватлеь появился в домашней зоне умного дома.

Помучавшись от того, что в triggers и condition нельзя сделать конструкцию вида "если событие длится меньше определенного времени", сделал все с помощью timer.
Алгоритм такой:

1) HA постоянно пингует носимое устройство пользователя, например телефон. Два состояния on и off
2) Как только наступило переключения с off на on, то есть телефон начал пинговаться, запускается именной таймер устройства. 
3) Если датчик открытия вхожной двери, срабатывает, когда таймер запущен, то передается команда на Яндекс станцию поприветствовать пользователя и таймер останавливается. 

Что нужно для реализации:

* HACS интеграция Yandex Smart Home(https://github.com/dmitry-k/yandex_smart_home)
* Датчик открытия двери, привязанный к HA
* DHCP, настроенный выдавать постоянные IP нужным устройствам. 

Что надо еще сделать:

На самом деле жутко неудобно для каждого пользователя записывать два правила автоматизации в HA. 
Надо разобраться с передачей сообщений между службами или правилами автоматизации. 
Чтобы можно было написать всего два правила и в блоках "ЕСЛИ" передавать кто к нам идет. 